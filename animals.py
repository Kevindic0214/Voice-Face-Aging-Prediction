import jieba
import os
import re
from collections import Counter, defaultdict

# 添加常見動物名稱到jieba詞典以提高分詞準確度
def enhance_animal_dictionary():
    common_animals = [
        # 家畜與寵物
        "貓", "狗", "小狗", "寵物狗", "家貓", "波斯貓", "暹羅貓", "英國短毛貓", "折耳貓", 
        "金毛", "拉布拉多", "哈士奇", "吉娃娃", "鬥牛犬", "德國牧羊犬", "薩摩耶", "博美", "柯基", 
        "獒", "松獅", "泰迪", "比熊", "牧羊犬", "邊境牧羊犬", "大麥町", "臘腸狗", "京巴", 
        "豬", "家豬", "小豬", "乳豬", "肥豬", "野豬", "黑豬", "白豬", "花豬", 
        "羊", "山羊", "綿羊", "黑山羊", "羔羊", "小羊", "牛", "水牛", "黃牛", "奶牛", "小牛", 
        "馬", "駿馬", "野馬", "小馬", "驢", "騾子", "驢子", "馬匹", "馬兒", 
        "雞", "公雞", "母雞", "小雞", "雛雞", "烏雞", "鬥雞", "土雞", "火雞", "野雞", 
        "鴨", "鴨子", "野鴨", "家鴨", "綠頭鴨", "北京鴨", "鵝", "大鵝", "天鵝", "黑天鵝", 
        "鸚鵡", "虎皮鸚鵡", "金剛鸚鵡", "灰鸚鵡", "鸚鵡", "金絲雀", "八哥", "烏龜", "倉鼠", 
        "兔", "兔子", "家兔", "寵物兔", "荷蘭豬", "豚鼠", "龍貓", "刺蝟", "松鼠",
        
        # 野生哺乳動物
        "老鼠", "老虎", "獅子", "豹", "花豹", "獵豹", "美洲豹", "雪豹", "金錢豹", "黑豹", 
        "熊", "黑熊", "棕熊", "北極熊", "熊貓", "大熊貓", "小熊貓", "紅熊貓", "無尾熊", 
        "猴", "猴子", "金絲猴", "長臂猿", "狒狒", "黑猩猩", "大猩猩", "山魈", "獼猴", "葉猴", 
        "大象", "非洲象", "亞洲象", "長頸鹿", "河馬", "犀牛", "斑馬", "袋鼠", "考拉", 
        "狐狸", "赤狐", "北極狐", "狼", "草原狼", "森林狼", "土狼", "豺", "貉", 
        "刺蝟", "松鼠", "飛鼠", "花栗鼠", "松鼠", "土撥鼠", "倉鼠", "田鼠", "水鼠", 
        "水獺", "海狸", "麝鼠", "鼴鼠", "穿山甲", "果子狸", "浣熊", "貂", "水貂", "貂熊", 
        "臭鼬", "獾", "貓鼬", "狐獴", "鼬", "黃鼠狼", "鼬鼠", "白鼻心", "蝙蝠", "果蝠", 
        "麋鹿", "梅花鹿", "馴鹿", "駝鹿", "羚羊", "藏羚羊", "羚牛", "羚羊", "黃羊", "鹿", 
        "瞪羚", "角馬", "野牛", "水牛", "非洲水牛", "氂牛", "牦牛", "黃牛", "野牛", 
        "疣豬", "河馬", "犀牛", "駱駝", "單峰駱駝", "雙峰駱駝", "羊駝", "美洲駝", 
        "樹懶", "食蟻獸", "犰狳", "貘", "長鼻貘", "貔貅", "麒麟",
        
        # 海洋哺乳動物
        "鯨", "藍鯨", "虎鯨", "抹香鯨", "灰鯨", "白鯨", "鯨魚", "座頭鯨", "須鯨", 
        "海豚", "白海豚", "江豚", "飛旋海豚", "海豹", "斑海豹", "港海豹", "海獅", "海象", 
        "海牛", "儒艮", "海獺", "水獺", "海狸", "海龍",
        
        # 鳥類
        "鳥", "小鳥", "鴿子", "麻雀", "鸚鵡", "老鷹", "鷹", "鷹隼", "禿鷹", "禿鷲", 
        "烏鴉", "喜鵲", "八哥", "白頭翁", "百靈鳥", "燕子", "杜鵑", "布穀鳥", "啄木鳥", 
        "夜鶯", "黃鸝", "蜂鳥", "鴕鳥", "鶴", "丹頂鶴", "白鶴", "黑頸鶴", "鷺", "白鷺", 
        "孔雀", "綠孔雀", "藍孔雀", "白孔雀", "藍鵲", "紅嘴藍鵲", "貓頭鷹", "鵪鶉", "鴛鴦", 
        "鷓鴣", "金雞", "錦雞", "紅腹錦雞", "畫眉", "相思鳥", "鸊鷉", "海鷗", "鴻雁", "大雁", 
        "雁", "鳳頭鸚鵡", "斑鳩", "珠頸斑鳩", "鷗", "戴勝", "翠鳥", "太平鳥", "鶯", "鵯", 
        "鶺鴒", "百靈", "鵐", "雀", "黃雀", "灰雀", "麻雀", "鷚", "畫眉", "鶇", "烏鴉", 
        "企鵝", "藍企鵝", "帝企鵝", "皇帝企鵝", "朱鷺", "鷸", "鸕鶿", "鳳凰", "朱雀", 
        "鴛鴦", "信天翁", "鵜鶘", "鰹鳥", "鵓鴿", "鴿", "家鴿", "白鴿", "鳩", "鴿子",
        
        # 爬行動物
        "蛇", "眼鏡蛇", "響尾蛇", "蟒蛇", "水蛇", "竹葉青", "金環蛇", "銀環蛇", "五步蛇", 
        "黑曼巴", "綠曼巴", "海蛇", "王蛇", "玉米蛇", "蝮蛇", "鎖鏈蛇", "蝙蝠蛇", 
        "蜥蜴", "壁虎", "守宮", "變色龍", "避役", "石龍子", "飛蜥", "巨蜥", "科莫多龍", 
        "鱷魚", "尼羅鱷", "短吻鱷", "亞美鱷", "揚子鱷", "鱷魚", "短吻鱷", "灣鱷", 
        "烏龜", "海龜", "綠海龜", "玳瑁", "棱皮龜", "泥龜", "鱉", "鱷龜", "箱龜", 
        "草龜", "金錢龜", "巴西龜", "麝香龜", "地圖龜", "蛋龜", "澤龜", "甲魚", "鱉",
        
        # 兩棲動物
        "青蛙", "樹蛙", "蟾蜍", "牛蛙", "雨蛙", "樹蛙", "林蛙", "虎紋蛙", "黑斑蛙", "金線蛙", 
        "蠑螈", "蝾螈", "娃娃魚", "大鯢", "蝌蚪", "泥鰍", "墨魚",
        
        # 魚類
        "魚", "金魚", "鯉魚", "鯽魚", "鯰魚", "鱸魚", "鯛魚", "鱈魚", "鮭魚", "鰱魚", 
        "鯊魚", "大白鯊", "鯨鯊", "虎鯊", "鎚頭鯊", "藍鯊", "灰鲭鯊", "沙虎鯊", "護士鯊", 
        "金槍魚", "旗魚", "鯡魚", "沙丁魚", "比目魚", "鰻魚", "河鰻", "電鰻", "魟魚", 
        "熱帶魚", "鯢魚", "鯧魚", "鰱魚", "鯇", "草魚", "青魚", "鯪魚", "鯁魚", "鮰魚", 
        "鱘魚", "鰶魚", "鮸魚", "黃魚", "劍魚", "飛魚", "海馬", "石斑魚", "鮎魚", "鲅魚", 
        "鮔魚", "鯷魚", "角魚", "箭魚", "駝背魚", "蝶魚", "蝴蝶魚", "神仙魚", "孔雀魚", 
        "鬥魚", "燈籠魚", "河豚", "刀魚", "龍魚", "銀龍魚", "帶魚", "鮃", "鰈魚", "比目魚", 
        "鰻魚", "電鰻", "泥鰍", "鰍魚", "鰻鱺", "鯔", "青魚", "黑魚", "餐條魚", "馬哈魚",
        
        # 昆蟲和無脊椎動物
        "蟲", "昆蟲", "蜜蜂", "蝴蝶", "蟑螂", "螞蟻", "蒼蠅", "蚊子", "蜘蛛", "蠍子", 
        "蜈蚣", "甲蟲", "龍蝦", "小龍蝦", "螃蟹", "大閘蟹", "梭子蟹", "帝王蟹", "花蟹", "青蟹", 
        "章魚", "烏賊", "魷魚", "鱆魚", "水母", "海蜇", "海星", "海膽", "海參", "海葵", 
        "蜻蜓", "蟬", "蟋蟀", "蝗蟲", "螳螂", "蝦", "基圍蝦", "南美白蝦", "蝦仁", "河蝦", 
        "蛾", "蠶", "蠶寶寶", "蝸牛", "蛞蝓", "蛆", "蝨子", "跳蚤", "蟎蟲", "蚯蚓", 
        "黃蜂", "馬蜂", "胡蜂", "大黃蜂", "黑胡蜂", "紅蟻", "白蟻", "花蝽", "竹節蟲", "蚱蜢", 
        "金蟬", "寒蟬", "油蟬", "蝙蝠蛾", "蠐螬", "豆娘", "蟻獅", "草蜢", "蝽", "臭蟲", 
        "水黽", "龍蝨", "蚋", "蠓", "果蠅", "芫菁", "草蛉", "狼蛛", "蟹蛛", "牡蠣", "蚶", 
        "扇貝", "鮑魚", "蛤蜊", "文蛤", "貽貝", "珍珠貝", "鮑", "螺", "田螺", "海螺", "貝", 
        "蜆", "蠔", "廣島蠔", "貝殼", "海蜇皮", "潮蟹", "江蟹", "蟹爪", "蛇妖蝎", "馬陸", 
        "水蛭", "螢火蟲", "蛞蝓", "珊瑚", "海綿", "珊瑚蟲", "海綿動物", "海百合", "海蟑螂",
        
        # 遠古和滅絕動物
        "恐龍", "三角龍", "暴龍", "霸王龍", "迅猛龍", "翼龍", "梁龍", "腕龍", "劍龍", "甲龍", 
        "異特龍", "鐵甲龍", "蜥腳類恐龍", "雷龍", "翼手龍", "鸚鵡嘴龍", "似鳥龍", "劍齒虎", 
        "猛獁象", "冰河猛象", "長毛象", "洞熊", "三趾馬", "洞獅", "披毛犀", "巨猿", "巨鹿", 
        "地懶", "古鯨", "古象", "馬門溪龍", "真馬", "旋齒鯊", "槍魚", "穿山甲",
        
        # 神話和傳說中的動物
        "龍", "鳳", "鳳凰", "麒麟", "貔貅", "獬豸", "窮奇", "螭", "應龍", "狻猊", 
        "饕餮", "龍鳳", "青龍", "白虎", "朱雀", "玄武", "梼杌", "渾沌", "九尾狐", "天狗"
    ]
    
    for animal in common_animals:
        jieba.add_word(animal)  # 添加到詞典中
    
    return common_animals

# 前處理文本：清理標點符號和語氣詞
def preprocess_text(text):
    # 替換標點符號為空格
    text = re.sub(r'[，。、；：！？,.;:!?]', ' ', text)
    
    taiwan_fillers = [
        # 基本停頓與填充詞
        "呃", "嗯", "啊", "哦", "喔", "唉", "誒", "欸", "呢", "吶", "那個", "這個", 
        "就是", "然後", "什麼", "怎麼說", "怎麼講", "我想想", "讓我想想", "我看看", 
        "你知道", "知道嗎", "你說呢", "是不是", "還有", "還有就是", "就像", "好像", 
        "大概", "可能", "基本上", "其實", "說起來", "說實話", "老實說", "坦白說", 
        "講真的", "所謂的", "對了", "對吧", "對不對", "是吧", "是嗎", "怎麼說呢",
        
        # 台灣特色停頓詞
        "這樣子", "那樣子", "這樣", "那樣", "之類的", "什麼的", "反正", "總之",
        "就是說", "怎麼講", "話說", "我是說", "你有在聽嗎", "有沒有", "對不",
        
        # 情緒表達詞
        "哎呀", "哎喲", "哇", "哇塞", "哎", "唷", "喲", "呀", "呦", "嘿", 
        "嘻", "嘻嘻", "呵", "呵呵", "嘿嘿", "嗨", "哈", "哈哈", "嗚", "嗚嗚", 
        "天哪", "天啊", "我的媽", "拜託", "算了", "算啦",
        
        # 句末語氣詞
        "吧", "啦", "嘛", "呀", "啊", "哇", "喔", "耶", "呢", "吶", "囉", "喲", 
        "嘿", "嘻", "哦", "呵", "嗯", "唷", "嗨", "誒", "欸", "對吧", "不是嗎", 
        "是不是", "可以嗎", "好不好", "行不行", "怎麼樣", "這樣", "那樣", "什麼的", 
        "等等", "就這樣", "好吧", "對不", "對嗎", "是嗎", "不是嗎", "不好吧", "還行吧", 
        "可以吧", "就醬", "就這樣子", "就這樣吧", "是否",
        
        # 思考或猶豫詞
        "這個嘛", "嗯...", "呃...", "哦...", "那個...", "就是說...", "怎麼說呢", 
        "我想想", "讓我想想", "等一下", "等等", "稍等", "我想", "我覺得", "應該是", 
        "可能是", "大概是", "也許是", "或許是", "差不多是", "好像是", "比如說", 
        "舉例來說", "我是說", "你是說", "他是說", "等我想一下", "讓我組織一下語言",
        
        # 口頭禪和習慣性用語
        "就", "不就", "就是", "就是說", "就像", "然後", "接著", "因為", 
        "所以", "但是", "可是", "不過", "那麼", "這麼", "如此", "所謂", "算是", 
        "也算", "姑且", "或者說", "要麼", "不然", "否則", "另外", "順便說", 
        "說到這", "題外話", "總之", "總而言之", "總的來說", "說白了", "簡單說",
        
        # 台灣/閩南方言語氣詞
        "啦", "喔", "咧", "耶", "嘿", "唷", "齁", "蛤", "啥", "哪", "喇", "勒", 
        "捏", "迺", "呸", "賽", "底加", "啊那", "哪甲", "乎", "咁", "咧", "啥毀", 
        "驚死人", "北七", "卡洨", "歹勢", "甘知", "蚵仔煎", "麥擱啦", "別啊",
        "哩", "哩勒", "蝦米", "蛤啊", "啊災", "齁齁", "白目", "瞎啊", "啊這",
        "卡好", "今仔日", "摳米", "母湯", "佛系", "啊佳", "啊災", "啊系", "蝦咪",
        
        # 台灣特色驚嘆詞
        "哇", "嘩", "哇塞", "天啊", "天哪", "媽呀", "我的天", "我的媽", 
        "哎呀", "哎喲", "嚯", "噢", "嗚", "嗚呼", "嘻", "耶", "喲", "哼",
        "哦", "呦", "啊", "呀", "啊呀", "厲害了", "神了", "猛耶", "勁喔",
        
        # 其他台灣常見
        "到底", "是說", "講真", "老實講", "要不然", "否則的話", "所以說", 
        "因此", "這不就", "這不是", "那不就", "那不是", "是否", "是也不是", 
        "像是", "很像", "超級", "無敵", "有夠", "這麼", "那麼", "多麼", "真的假的",
        "真的嗎", "真假", "不會吧", "怎麼可能", "不是吧", "不會齁", "不是齁", 
        "這樣齁", "那樣齁", "好險", "剛好", "難怪", "難道", "居然", "幹嘛", "啥洨"
    ]
    # 處理語氣詞
    for filler in taiwan_fillers:
        text = text.replace(filler, ' ')
    
    return text

# 從文本中提取可能的動物名稱
def extract_animals(text, common_animals):
    # 前處理文本
    text = preprocess_text(text)
    
    # 使用jieba分詞
    words = [word for word in jieba.cut(text) if word.strip()]
    
    # 從分詞結果中提取可能的動物名稱
    potential_animals = []
    for word in words:
        # 1. 直接匹配常見動物列表
        if word in common_animals:
            potential_animals.append(word)
        
        # 2. 檢查複合詞中是否包含動物名稱
        # 例如"小老鼠"應該識別為"老鼠"
        for animal in common_animals:
            if animal in word and animal != word:
                potential_animals.append(animal)
    
    return potential_animals

# 處理整個目錄中的所有txt檔案
def process_all_files(directory_path):
    # 增強jieba的動物詞典
    common_animals = enhance_animal_dictionary()
    
    # 儲存所有發現的動物
    all_animals = set()
    
    # 儲存每個檔案中發現的動物
    file_animals = {}
    
    # 儲存每個動物在多少檔案中出現
    animal_frequency = defaultdict(int)
    
    # 處理每個txt檔案
    for filename in os.listdir(directory_path):
        if filename.endswith('.txt'):
            file_path = os.path.join(directory_path, filename)
            
            try:
                # 讀取檔案內容
                with open(file_path, 'r', encoding='utf-8') as f:
                    text = f.read()
                
                # 提取動物名稱
                animals = extract_animals(text, common_animals)
                
                # 去重
                unique_animals = set(animals)
                
                # 更新全局集合
                all_animals.update(unique_animals)
                
                # 儲存該檔案的結果
                file_animals[filename] = unique_animals
                
                # 更新頻率計數
                for animal in unique_animals:
                    animal_frequency[animal] += 1
                
                print(f"已處理: {filename} - 發現 {len(unique_animals)} 種動物")
                
            except Exception as e:
                print(f"處理 {filename} 時出錯: {e}")
    
    # 生成報告
    print("\n===== 動物名稱分析報告 =====")
    print(f"總共發現 {len(all_animals)} 種不同的動物")
    print("\n出現頻率最高的動物:")
    
    # 以頻率排序動物
    sorted_animals = sorted(animal_frequency.items(), key=lambda x: x[1], reverse=True)
    for animal, count in sorted_animals[:20]:  # 顯示前20種最常見的動物
        print(f"{animal}: 在 {count} 個檔案中出現 ({count/len(file_animals)*100:.1f}%)")
    

    # 保存動物列表
    with open('animal_list.txt', 'w', encoding='utf-8') as f:
        for animal in sorted(all_animals):
            f.write(animal + '\n')
    print("所有動物列表已保存至 animal_list.txt")
    
    return all_animals, file_animals, animal_frequency

# 使用範例
all_animals, file_animals, animal_frequency = process_all_files('2025-04-23_Result')